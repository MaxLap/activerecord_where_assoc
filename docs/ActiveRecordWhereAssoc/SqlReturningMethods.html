<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>module ActiveRecordWhereAssoc::SqlReturningMethods - activerecord_where_assoc</title>

  <meta name="keywords" content="ruby,module,ActiveRecordWhereAssoc::SqlReturningMethods">

    <meta name="description" content="module ActiveRecordWhereAssoc::SqlReturningMethods: The methods in this module return partial SQL queries. RelationReturningMethods.">

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
  var index_rel_prefix = "../";
</script>

<script src="../js/navigation.js" defer></script>
<script src="../js/search.js" defer></script>
<script src="../js/search_index.js" defer></script>
<script src="../js/searcher.js" defer></script>
<script src="../js/darkfish.js" defer></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">
<link href="../docs_customization.css" rel="stylesheet">


<body id="top" role="document" class="module">
<div id="navigation-toggle" role="button" tabindex="0" aria-label="Toggle sidebar" aria-expanded="true" aria-controls="navigation">
  <span aria-hidden="true">&#9776;</span>
</div>


<nav id="navigation" role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search (/) for a class, method, ..." spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
  
  
  
  
  


  <div class="nav-section">
    <h3>Instance Methods</h3>
    <ul class="link-list" role="directory">
      <li ><a href="#method-i-assoc_exists_sql">assoc_exists_sql</a></li>
      <li ><a href="#method-i-assoc_not_exists_sql">assoc_not_exists_sql</a></li>
      <li ><a href="#method-i-compare_assoc_count_sql">compare_assoc_count_sql</a></li>
      <li ><a href="#method-i-only_assoc_count_sql">only_assoc_count_sql</a></li>
    </ul>
  </div>



  <footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.12.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

</nav>

<main role="main" aria-labelledby="module-ActiveRecordWhereAssoc::SqlReturningMethods">
  <h1 id="module-ActiveRecordWhereAssoc::SqlReturningMethods" class="anchor-link module">
    module ActiveRecordWhereAssoc::SqlReturningMethods
  </h1>

  <section class="description">
    
<p>The methods in this module return partial SQL queries. These are used by the main methods of this gem: the #where_assoc_* methods located in <a href="RelationReturningMethods.html"><code>RelationReturningMethods</code></a>. But in some situation, the SQL strings can be useful to do complex manual queries by embedding them in your own SQL code.</p>

<p>Those methods should be used directly on your modelâ€™s class. You can use them from a relation, but the result will be the same, so your intent will be clearer by doing it on the class directly.</p>

<pre class="ruby"><span class="ruby-comment"># This is the recommended way:</span>
<span class="ruby-identifier">sql</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">assoc_exists_sql</span>(<span class="ruby-value">:posts</span>)

<span class="ruby-comment"># While this also works, it may be confusing when reading the code:</span>
<span class="ruby-identifier">sql</span> = <span class="ruby-identifier">my_filtered_users</span>.<span class="ruby-identifier">assoc_exists_sql</span>(<span class="ruby-value">:posts</span>)
<span class="ruby-comment"># the sql variable is not affected by my_filtered_users.</span>
</pre>

  </section>

  <section id="5Buntitled-5D" class="documentation-section anchor-link">





     <section id="public-instance-5Buntitled-5D-method-details" class="method-section anchor-link">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

      <div id="method-i-assoc_exists_sql" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-assoc_exists_sql" title="Link to this method">
                <span class="method-name">assoc_exists_sql</span>
                <span class="method-args">(association_name, conditions = nil, options = {}, &amp;block)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="assoc_exists_sql-source">
            <pre><span class="ruby-comment"># File lib/active_record_where_assoc/sql_returning_methods.rb, line 29</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">assoc_exists_sql</span>(<span class="ruby-identifier">association_name</span>, <span class="ruby-identifier">conditions</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">options</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-constant">ActiveRecordWhereAssoc</span><span class="ruby-operator">::</span><span class="ruby-constant">CoreLogic</span>.<span class="ruby-identifier">assoc_exists_sql</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">association_name</span>, <span class="ruby-identifier">conditions</span>, <span class="ruby-identifier">options</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>This method returns a string containing the SQL condition used by <a href="RelationReturningMethods.html#method-i-where_assoc_exists"><code>RelationReturningMethods#where_assoc_exists</code></a>. You can pass that SQL string directly to #where to get the same result as <a href="RelationReturningMethods.html#method-i-where_assoc_exists"><code>RelationReturningMethods#where_assoc_exists</code></a>. This can be useful to get the SQL of an EXISTS query for use in your own SQL code.</p>

<p>For example:</p>

<pre class="ruby"><span class="ruby-comment"># Users with a post or a comment</span>
<span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;#{User.assoc_exists_sql(:posts)} OR #{User.assoc_exists_sql(:comments)}&quot;</span>)
<span class="ruby-identifier">my_users</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;#{User.assoc_exists_sql(:posts)} OR #{User.assoc_exists_sql(:comments)}&quot;</span>)
</pre>

<p>The parameters are the same as <a href="RelationReturningMethods.html#method-i-where_assoc_exists"><code>RelationReturningMethods#where_assoc_exists</code></a>, including the possibility of specifying a list of association_name.</p>
        </div>


      </div>

      <div id="method-i-assoc_not_exists_sql" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-assoc_not_exists_sql" title="Link to this method">
                <span class="method-name">assoc_not_exists_sql</span>
                <span class="method-args">(association_name, conditions = nil, options = {}, &amp;block)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="assoc_not_exists_sql-source">
            <pre><span class="ruby-comment"># File lib/active_record_where_assoc/sql_returning_methods.rb, line 38</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">assoc_not_exists_sql</span>(<span class="ruby-identifier">association_name</span>, <span class="ruby-identifier">conditions</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">options</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-constant">ActiveRecordWhereAssoc</span><span class="ruby-operator">::</span><span class="ruby-constant">CoreLogic</span>.<span class="ruby-identifier">assoc_not_exists_sql</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">association_name</span>, <span class="ruby-identifier">conditions</span>, <span class="ruby-identifier">options</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>This method generates the SQL query used by <a href="RelationReturningMethods.html#method-i-where_assoc_not_exists"><code>RelationReturningMethods#where_assoc_not_exists</code></a>. This method is the same as <a href="SqlReturningMethods.html#method-i-assoc_exists_sql"><code>#assoc_exists_sql</code></a>, but for <a href="RelationReturningMethods.html#method-i-where_assoc_not_exists"><code>RelationReturningMethods#where_assoc_not_exists</code></a>.</p>

<p>The parameters are the same as <a href="RelationReturningMethods.html#method-i-where_assoc_not_exists"><code>RelationReturningMethods#where_assoc_not_exists</code></a>, including the possibility of specifying a list of association_name.</p>
        </div>


      </div>

      <div id="method-i-compare_assoc_count_sql" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-compare_assoc_count_sql" title="Link to this method">
                <span class="method-name">compare_assoc_count_sql</span>
                <span class="method-args">(left_assoc_or_value, operator, right_assoc_or_value, conditions = nil, options = {}, &amp;block)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="compare_assoc_count_sql-source">
            <pre><span class="ruby-comment"># File lib/active_record_where_assoc/sql_returning_methods.rb, line 58</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">compare_assoc_count_sql</span>(<span class="ruby-identifier">left_assoc_or_value</span>, <span class="ruby-identifier">operator</span>, <span class="ruby-identifier">right_assoc_or_value</span>, <span class="ruby-identifier">conditions</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">options</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-constant">ActiveRecordWhereAssoc</span><span class="ruby-operator">::</span><span class="ruby-constant">CoreLogic</span>.<span class="ruby-identifier">compare_assoc_count_sql</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">left_assoc_or_value</span>, <span class="ruby-identifier">operator</span>, <span class="ruby-identifier">right_assoc_or_value</span>, <span class="ruby-identifier">conditions</span>, <span class="ruby-identifier">options</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>This method returns a string containing the SQL condition used by <a href="RelationReturningMethods.html#method-i-where_assoc_count"><code>RelationReturningMethods#where_assoc_count</code></a>. You can pass that SQL string directly to #where to get the same result as <a href="RelationReturningMethods.html#method-i-where_assoc_count"><code>RelationReturningMethods#where_assoc_count</code></a>. This can be useful to get the SQL query to compare the count of an association for use in your own SQL code.</p>

<p>For example:</p>

<pre class="ruby"><span class="ruby-comment"># Users with at least 10 posts or at least 10 comment</span>
<span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;#{User.compare_assoc_count_sql(:posts, :&gt;=, 10)} OR #{User.compare_assoc_count_sql(:comments, :&gt;=, 10)}&quot;</span>)
<span class="ruby-identifier">my_users</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;#{User.compare_assoc_count_sql(:posts, :&gt;=, 10)} OR #{User.compare_assoc_count_sql(:comments, :&gt;=, 10)}&quot;</span>)

<span class="ruby-comment"># The older way of doing the same thing (the order of parameter used to be reversed,</span>
<span class="ruby-comment"># both order work when using a number or a range as one of the operand)</span>
<span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;#{User.compare_assoc_count_sql(10, :&lt;=, :posts)} OR #{User.compare_assoc_count_sql(10, :&lt;=, :comments)}&quot;</span>)
<span class="ruby-identifier">my_users</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;#{User.compare_assoc_count_sql(10, :&lt;=, :posts)} OR #{User.compare_assoc_count_sql(10, :&lt;=, :comments)}&quot;</span>)
</pre>

<p>The parameters are the same as <a href="RelationReturningMethods.html#method-i-where_assoc_count"><code>RelationReturningMethods#where_assoc_count</code></a>, including the possibility of specifying a list of association_name.</p>
        </div>


      </div>

      <div id="method-i-only_assoc_count_sql" class="method-detail anchor-link ">
        <div class="method-header">
            <div class="method-heading">
              <a href="#method-i-only_assoc_count_sql" title="Link to this method">
                <span class="method-name">only_assoc_count_sql</span>
                <span class="method-args">(association_name, conditions = nil, options = {}, &amp;block)</span>
              </a>
            </div>
        </div>

          <div class="method-controls">
            <details class="method-source-toggle">
              <summary>Source</summary>
            </details>
          </div>

        <div class="method-description">
          <div class="method-source-code" id="only_assoc_count_sql-source">
            <pre><span class="ruby-comment"># File lib/active_record_where_assoc/sql_returning_methods.rb, line 75</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">only_assoc_count_sql</span>(<span class="ruby-identifier">association_name</span>, <span class="ruby-identifier">conditions</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">options</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-constant">ActiveRecordWhereAssoc</span><span class="ruby-operator">::</span><span class="ruby-constant">CoreLogic</span>.<span class="ruby-identifier">only_assoc_count_sql</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">association_name</span>, <span class="ruby-identifier">conditions</span>, <span class="ruby-identifier">options</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          <p>This method returns a string containing the SQL to count an association used by <a href="RelationReturningMethods.html#method-i-where_assoc_count"><code>RelationReturningMethods#where_assoc_count</code></a>. The returned SQL does not do a comparison, only the counting part. So you can do the comparison yourself. This can be useful to get the SQL to count the an association query for use in your own SQL code.</p>

<p>For example:</p>

<pre class="ruby"><span class="ruby-comment"># Users with more posts than comments</span>
<span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;#{User.only_assoc_count_sql(:posts)} &gt; #{User.only_assoc_count_sql(:comments)}&quot;</span>)
<span class="ruby-identifier">my_users</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;#{User.only_assoc_count_sql(:posts)} &gt; #{User.only_assoc_count_sql(:comments)}&quot;</span>)
</pre>

<p>Since the comparison is not made by this method, the first 2 parameters (left_operand and operator) of <a href="RelationReturningMethods.html#method-i-where_assoc_count"><code>RelationReturningMethods#where_assoc_count</code></a> are not accepted by this method. The remaining parameters of <a href="RelationReturningMethods.html#method-i-where_assoc_count"><code>RelationReturningMethods#where_assoc_count</code></a> are accepted, which are the same the same as those of <a href="RelationReturningMethods.html#method-i-where_assoc_exists"><code>RelationReturningMethods#where_assoc_exists</code></a>.</p>
        </div>


      </div>

    </section>

  </section>
</main>

